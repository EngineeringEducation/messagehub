<!doctype html>
<html>
 <head>
  <title>My Bookshelf</title>
  <style>
body {
  font-family: Arial, sans-serif;
}

  </style>
 </head>

 <div id="channel">

 </div>

 <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
 <script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.4.4/underscore-min.js"></script>
 <script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/backbone.js/0.9.10/backbone-min.js"></script>
 
 <script>
 var MessageModel = Backbone.Model.extend({
  defaults: {
    channel_token: 'Untitled',
    type_token: 'Unknown',
    user_name: 'Mystery User',
    message_text: "I'm broken!",
    message_timestamp: Date.now()
  },
  initialize: function() {
    // function of sadness
  }
});

var MessageCollection = Backbone.Collection.extend({
    model: MessageModel,
    comparator: function() {
      return this.get('message_timestamp');
    },
    url : function() {
      return "http://localhost:5000/" + this.type + "/" + this.channel;
    },
    initialize : function (models, options) {
      this.type = options.type;
      this.channel = options.channel;
    }
});

var MessageView = Backbone.View.extend({
  className: 'message',
  render: function() {
    var userNameContainer = $('<div class="user">');
    userNameContainer.html(this.model.get('user_name') + " : ");
    var messageTextContainer = $('<div class="message-text">');
    messageTextContainer.html(this.model.get('message_text'));
    this.$el.append(userNameContainer.html())
    this.$el.append(messageTextContainer.html())
    return this;
  }
});

var ChannelView = Backbone.View.extend({
  render: function() {
    var self = this;
    // self.$el.append($('Type : <input id="type" type="text" name="type">'));
    // self.$el.append($('Channel : <input id="channel" type="text" name="channel">'));
    // self.$el.append($('Channel : <button id="switch">Switch Channel</button>'));
    for (var i = 0; i < this.collection.models.length; i++) {
        var message = this.collection.models[i]
        var messageContainer = new MessageView({model:message});
        messageContainer.render()
        self.$el.append(messageContainer.$el);
    };
    return this;
  }
});

$(document).ready(function() {
	messages = new MessageCollection([],{type: "sample", channel: "livecode"});
  messages.fetch({
    success : function () {
      var channel = new ChannelView({collection: messages});
      $('#channel').append(channel.render().$el);
    }
  });
});
 </script>
</html>